# shell编程

## shell脚本的执行方式

- 脚本的格式要求：
  - 脚本需要以`#!/bin/bash`开头
  - 脚本需要有可执行权限
- 脚本的执行方式
  - 赋予脚本可执行的权限，然后直接输入脚本的绝对路径或者相对路径即可
  - 使用`sh 脚本`来执行

## 变量

shell中的变量分为系统变量和自定义变量两种。

- 系统变量：比如`$HOME`,`$PATH`等，可以通过`set`命令来查看系统变量
- 自定义变量：与其他编程语言的变量定义相同。

### 基本语法

**定义变量：**

```shell
变量名=值
```

变量名不能以数字开头，一般使用大写。

**撤销变量：**

```shell
unset 变量
```

**声明静态变量：**

```shell
readonly 变量
```

静态变量不能被撤销`unset`

**赋值**

变量之间的赋值直接用`=`即可，如果需要把命令的执行结果赋值给变量，就需要使用反引号或者`$`

例如：

```shell
A=`date`
A=$(date)
```

**注释**

使用`#`进行单行注释

使用`:<<!注释内容!`进行多行注释

### 设置环境变量

1. 将shell变量输出为全局变量，在`/etc/profile`文件中写入之后，可以在其他文件中导入该变量

```shell
export 变量名=变量值
```

2. 刷新，让修改之后的配置信息立即生效

```shell
source /etc/prefile
```

### 位置参数变量

在执行命令行的的时候，我们有些时候往往会希望再命令行添加一些其他的参数进去，这个时候，我们可以在脚本中使用位置参数获取命令行传入的参数。例如：

```shell
./hello.sh 100 200
```

其中`100`,`200`就是传入的参数。在脚本中我们使用位置参数变量来接收这些传入的参数。

下面是位置参数变量的一些语法：

```shell
$num				#num为数字，从0开始编号，9以上的数字需要{}扩起，比如${10}
$*					#表示命令行中的所有参数,$*将所有参数看为一个整体
$@					#表示命令行中的所有参数,$@将每个参数分开看待
$#					#表示命令行中所有参数的个数
```

### 预定义变量

已经预定义好了，可以直接使用的变量

```shell
$$					#获取进程号
$!					#获取最后一个执行进程的进程号
$?					#最后一个命令执行的状态，0表示正确执行，非0表示执行出现问题
```

### 运算符

推荐下面两种方法

```shell
$((运算式))
$[运算式]
```



## 语句

## if语句

**条件判断语法**

一定注意[]两侧要有空格

```shell
[ condition ]					#注意condition两侧都需要有空格,非空返回true
=							   #字符串比较
#整数比较
	-lt  	<
	-le  	<=
	-eq  	=
	-gt		>
	-ge		>=
	-ne		!=
	
#按照文件权限进行判断
	-r		可读
	-w		可写
	-x		可执行
	
#按照文件类型判断
	-f		文件存在且是一个常规文件
	-e		文件存在
	-d		文件存在且是一个目录
```

**流程语句**

```
if [ 条件判断语句 ]
then
代码
elif [ 条件控制语句 ]
then
代码
fi
```

case语句

```shell
case $变量 in
"value1")
demon1
;;
"value2")
demon2
;;
....
esac
```



## 循环

**for循环**

语法1：

```sh
for 变量 in 值1 值2 值3 值4..
do 
demon
done
```

语法2：

```sh
for((初始值;循环控制条件;变量变化))
do
demon
done
```



**while循环**

```sh
while [ 循环条件 ]
do 
demon
done
```



## 函数

### 使用read读取输入

我们可以使用read来读取输入

基本语法：`read(选项)(参数)`

- 选项：
  - `-p`:指定读取的提示符，类似于python中的input函数括号中需要的内容
  - `-t`:指定读取时等待的时间，如果在指定时间没有输入就不在等待
- 参数：
  - 变量：指定读取值的变量名
- 例如：
  - `read -p "请输入一个数NUM1=" NUM1`
  - `read -t 10 -p "请输入一个数NUM2=" NUM2`

### 函数

有系统函数（类似于库函数）与自定义函数

- 常见的系统函数：
  - `basename`:返回完整路径最后一个`/`之后的部分，常用于获取文件名
    - `basename string suffix`其中suffix是后缀，如果suffix被指定，那么会去除suffix的部分，只保留一个名字
    - 例如：`basename /home/aaa/test.txt .txt`
  - `dirname`:返回的是前面的部分，也就是查找路径
    - `dirname path`

自定义函数语法

```sh
function fun_name()
{
	demon;
	#return可有可无
	return ;
}
#调用
fun_name 参数1 参数2
```





