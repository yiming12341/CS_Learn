# 进程管理

基本上，每个进程都是由宁外一个进程创建的。`fork`系统调用为当前进程创建一个子进程，子进程拥有和父本一样的资源。wait强制进程暂停直到宁一个进程结束。`exec`进程在当前进程中执行一个新的程序，`exit`用于退出当前进程。

shell实质上也是一个进程，我们可以用`echo $$`来查看其进程ID。通常命令分为两种内部命令和外部命令，内部命令只需要使用shell解释就可以了，不需要单独创建进程。当运行外部进程的时候，shell会首先fork父进程，然后调用exec执行子进程，并在父进程中使用wait使父进程处于等待状态，直到子进程结束后，这时候子进程exit，重新进入shell这个进程。

> 例如：执行vi命令的时候，会跳转，这就是因为子进程exec vi，然后把原本父进程的副本换为vi进程的，指导退出的时候，又回到了shell。

## 基本概念

### init进程

`init`进程是系统严格意义来说的第一个进程，也被称为初始化进程，其进程号为`#1`。`init`进程会打开系统控制台，并挂载根文件系统，然后运行`/etc/inittab`脚本，这一过程将创造诸多后续开机的所需要使用的进程。

### 前台进程和后台进程

在Linux中，前台进程和后台进程是指进程在系统中运行的状态。

前台进程是指当前正在运行的进程，它会占用终端的输入和输出，用户可以通过键盘输入命令，并且可以看到命令的输出结果。当一个进程在前台运行时，它会阻塞终端，直到进程执行完毕或被中断。

后台进程是指不需要占用终端输入输出的进程，它可以在后台静默地运行，同时允许用户在终端上执行其他命令。后台进程的运行不会影响前台进程的执行，用户可以随时查看后台进程的运行状态，也可以随时将其切换到前台运行。

在Linux中，可以通过在命令末尾添加“&”符号将一个进程转换为后台进程运行，例如：

```shell
ls > test
```

输出结果如下:

```shell
[1] 4495
[1]  + 4495 done       ls --color=tty > test.txt  
```

这说明程序已经成功在后端执行，启动的作业号为1，进程号为4

### sleep

我们通常使用`sleep`来控制时间的延长

```bash
sleep time[s|m|h|d]
```

time指延长的时长，例如：`sleep 5s`

## 作业管理

### jobs

当我们创建了一系列的作业的时候，我们可以使用`jobs`命令常看运行在后端的命令。

如果我们还想知道job的具体进程号，我们可以使用`-l`参数。

在作业前面的`+`表示当前作业，`-`代表上一个作业。

### fg

fg命令用于启动作业的进行。

```bash
fg					#启动当前的作业
fg %num				#启动作业号为num的程序
fg %name			#启动含有name名字的程序
```

### bg

`bg` 是一个 Unix/Linux 系统下的命令，用于将一个在前台运行的作业转移到后台继续执行。具体来说，`bg` 命令可以将一个被 `Ctrl + Z` 暂停的作业重新启动，并将其放到后台运行，让该作业继续执行。

`bg` 命令的具体用法如下：

```bash
bg [job_spec]
```

其中，`job_spec` 是一个可选参数，用于指定要转移到后台运行的作业。如果不指定该参数，则默认将当前正在前台运行的作业转移到后台运行。

`bg` 命令的主要作用是让一个被暂停的作业在后台继续执行，这样可以避免该作业占用当前 shell 的控制台，同时也可以让该作业在后台继续执行，直到执行完成。使用 `bg` 命令转移到后台运行的作业可以使用 `jobs` 命令查看其状态，也可以使用 `kill` 命令来终止该作业的执行。

## 进程控制

### ps

`ps`用于显示进程的信息。这个命令很复杂，有三类选项，分为Unix选项（以`-`开头）和BSD选项（选项无`-`）。

使用`ps`命令，其结果有很多选项。下面是 `ps` 命令常用的列选项及其含义：

| 列选项    | 含义                    |
| --------- | ----------------------- |
| `USER`    | 进程的所有者            |
| `PID`     | 进程的 ID               |
| `PPID`    | 父进程的ID              |
| `%CPU`    | 进程占用 CPU 的使用率   |
| `%MEM`    | 进程占用内存的使用率    |
| `VSZ`     | 进程使用的虚拟内存大小  |
| `RSS`     | 进程使用的物理内存大小  |
| `TTY`     | **进程所在的终端**      |
| `STAT`    | 进程的状态              |
| `START`   | 进程启动的时间          |
| `TIME`    | 进程占用 CPU 的累计时间 |
| `COMMAND` | 进程的命令行            |

其中，`STAT` 列的取值有多种，常见的取值及其含义如下：

| 取值 | 含义                                             |
| ---- | ------------------------------------------------ |
| `R`  | 进程正在运行                                     |
| `S`  | 进程处于休眠状态                                 |
| `T`  | 进程被停止了                                     |
| `Z`  | 进程已经终止，但是其父进程还没有回收该进程的资源 |
| `D`  | 进程在等待磁盘 I/O 操作                          |
| `I`  | 进程在等待中断                                   |
| `W`  | 进程在等待系统资源                               |
| `<`  | 进程的优先级比较低                               |
| `N`  | 进程的优先级比较高                               |
| `+`  | 进程在前台运行                                   |

### top

用于查看系统进程

```sh
top
```

### pstree

用于显示进程之间的创建关系

### kill

用于杀死进程

```sh
kill pid
kill -9 pid 					#强制杀死进程
```

**用于发送信号**

常见的信号如下：

| 信号编号 | 信号名称   | 描述                                                         |
| -------- | ---------- | ------------------------------------------------------------ |
| 1        | `SIGHUP`   | 终端断开或进程结束时发送给进程的信号。通常用于通知进程重新读取配置文件或重启。 |
| 2        | `SIGINT`   | 当用户在终端上按下 `Ctrl + C` 时发送给进程的信号，用于中断进程的执行。 |
| 3        | `SIGQUIT`  | 当用户在终端上按下 `Ctrl + \` 时发送给进程的信号，用于请求进程结束。 |
| 9        | `SIGKILL`  | 强制终止进程的信号，无法被忽略或捕获。                       |
| 15       | `SIGTERM`  | 通知进程结束的信号，可以被捕获或忽略。                       |
| 17       | `SIGSTOP`  | 暂停进程的执行的信号，可以通过 `SIGCONT` 信号重新启动进程。  |
| 18       | `SIGTSTP`  | 当用户在终端上按下 `Ctrl + Z` 时发送给进程的信号，用于暂停进程的执行。 |
| 19       | `SIGCONT`  | 用于恢复被暂停的进程的执行的信号。                           |
| 20       | `SIGCHLD`  | 通知父进程一个子进程已经结束或停止的信号。                   |
| 28       | `SIGWINCH` | 当终端窗口大小发生变化时发送给进程的信号。                   |

```sh
kill -信号编号 pid
kill -信号描述 pid
```

如果不指定，则会默认15号`SIGTERM`信号

### nice

用于设置尚未执行的进程的优先级

一般情况下，nice将优先级分为0-19,20个，数字越大优先级越低。

语法：

```bash
nice [-n 优先级] command
```

### renice

设置当前正在执行的命令的优先级

```shell
renice - 优先级 -p pid
```

### 守护进程

守护进程（Daemon）是一种在后台运行的进程，通常没有控制终端，通过在系统启动时自动启动并运行，提供一些常驻服务，如网络服务、日志服务等。守护进程通常会在系统启动时自动启动，并在系统运行期间一直运行，直到系统关闭或手动停止为止。

守护进程的特点包括：

- 守护进程通常在后台运行，没有控制终端，也就是说它们不受用户的交互影响；
- 守护进程通常在系统启动时自动启动，并在系统运行期间一直运行，直到系统关闭或手动停止为止；
- 守护进程通常不会向用户输出信息，而是将输出信息记录到日志文件中；
- 守护进程通常会提供一些常驻服务，如网络服务、日志服务等。

下面列出一些常见的守护进程及其功能：

| 守护进程       | 功能                  |
| -------------- | --------------------- |
| `sshd`         | 提供 SSH 连接服务     |
| `httpd`        | 提供 Web 服务         |
| `mysqld`       | 提供 MySQL 数据库服务 |
| `crond`        | 提供定时任务服务      |
| `rsyslogd`     | 提供系统日志服务      |
| `ntpd`         | 提供网络时间同步服务  |
| `acpid`        | 提供电源管理服务      |
| `avahi-daemon` | 提供网络服务发现服务  |
| `dnsmasq`      | 提供 DNS 和 DHCP 服务 |

需要注意的是，不同的 Linux 发行版可能会有不同的守护进程和服务，具体的守护进程和服务可能会有所不同。如果你需要了解某个特定系统中的守护进程和服务，可以查看该系统的文档或手册。

通常守护进程的`TTY`是`?`应为它不受终端的控制。
